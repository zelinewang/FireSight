# FireSight 可视化应用 – 开发文档（V 1.1）

---

## 1. 功能概述

FireSight 是一款面向公众的 Web 应用，基于公开卫星热点数据展示美国野火动态。核心能力包括：

* 基于 Leaflet 的可交互 2D 地图视图
* 热点定位、悬停高亮、点击查看详情
* 基于简化模型的 **6 小时火势蔓延预测** 可视化
* 15 分钟自动刷新及手动刷新
* 当数据源不可用或当前视区无数据时的友好空状态提示

---

## 2. 详细功能描述

### 2.1 UI 展示

| 区域                 | 元素                                                                                    | 样式与规则                                                                                           |
| ------------------ | ------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| **主视图**            | 2D 地图（Leaflet）                                                                     | • OpenStreetMap 底图<br>• 顶部右侧放置 *“响应式设计”* 切换按钮<br>• 切换时保持相机中心与缩放级别                             |
| **页眉 Header**      | • 应用标题 *“FireSight”*<br>• 状态文本 *“Last updated: YYYY-MM-DD HH\:MM UTC”*<br>• 刷新按钮 `🔄` | • 固定左上，z-index 1000<br>• `rgba(0,0,0,0.6)` 背景，圆角 8 px<br>• 字体白色；刷新按钮悬停时变亮                       |
| **热点标识**           | 红色实心圆 + 1 px 白色描边                                                                     | • 半径 6 px；悬停时放大至 8 px<br>• 数据驱动批量渲染（Cesium `PointPrimitiveCollection` / Leaflet `circleMarker`) |
| **蔓延预测环**          | 半透明黄色填充多边形 + 红色外描边                                                                    | • 透明度 0.3；描边宽 1 px<br>• 半径 = `spread_radius_km * 1000` 米<br>• MVP 为等圆；预留风向椭圆实现接口                |
| **信息面板 InfoPanel** | 详情字段列表                                                                                | • 左侧滑入，宽 280 px，高 100%<br>• 同页眉配色，滚动条隐藏<br>• 关闭按钮 `×` 位于右上角                                     |
| **空状态**            | 文本 + 插画                                                                               | • 居中显示 *“No active hotspots in view”* 或错误信息<br>• 提供 “Retry” 按钮                                  |

### 2.2 交互流程

1. **应用加载**

   * 初始化 Cesium/Leaflet，飞向默认视角 (`lat=37.5, lon=-120, height=5e6m`)
   * 调用 `loadData()` → 渲染热点与蔓延环 → 更新时间戳
2. **悬停**

   * 鼠标进入标识 → 标识放大；指针变为 `pointer`
   * 离开标识 → 复原
3. **点击**

   * 单击标识 → 打开 InfoPanel，填充该热点属性
   * 再次点击空白处或 `×` → InfoPanel 隐藏
4. **刷新**

   * 用户点击 `🔄` → 调用 `loadData(true)`（强制刷新）
   * 每 15 min 调度 `loadData()` 自动刷新
5. **视图切换**

   * 点击 `3D/2D` 切换 → 隐藏当前容器，显示另一容器；保持相同中心点
   * 这个功能取消，因为3D构建目前太复杂
6. **错误处理**

   * `fetch` 失败 → 页面顶部出现红色横幅 *“Data fetch failed (HTTP xxx). Retry?”*

### 2.3 逻辑功能

| 模块         | 说明                                                                             |
| ---------- | ------------------------------------------------------------------------------ |
| **数据获取**   | `GET /data/wildfires.geojson` (本地或 CDN)<br>• 若请求失败：抛异常 → 显示错误横幅                |
| **数据解析**   | 遍历 `features[]`，记录属性并计算像素半径                                                    |
| **渲染流水线**  | `clearLayers()` → `renderHotspots()` → `renderRings()`                         |
| **蔓延半径计算** | 已写入 `spread_radius_km`，MVP 不再实时计算；预留 `computeRadius(brightness, windKph)` (可选) |
| **自动刷新**   | `setInterval(loadData, 900000)`                                                |
| **空状态检测**  | `if (featureCount === 0) showEmptyState()`                                     |
| **深链接**    | 点击 InfoPanel 中的 “Share” 复制 `?lat=…&lon=…` URL                                  |

---

## 3. 数据模型

```jsonc
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "lat": 34.123,
        "lon": -118.456,
        "brightness": 350.6,          // K
        "acq_datetime": "2025-06-27T11:10:00Z",
        "confidence": "high",
        "satellite": "Aqua",
        "spread_radius_km": 5.4
      },
      "geometry": { "type": "Point", "coordinates": [-118.456, 34.123] }
    }
  ]
}
```

---

## 4. 不确定的技术细节

| 项目             | 备注                                                 |
| -------------- | -------------------------------------------------- |
| **初始相机位置**     | 待根据评委关注区域调整 (不确定)                                  |
| **风向椭圆算法**     | 需获取实时风向/风速 API (不确定)                               |
| **热点悬停放大像素**   | 具体增量 2 px 或 3 px 待调试 (不确定)                         |
| **错误提示 UI 形式** | 横幅 / Modal 二选一，最终由设计定稿 (不确定)                       |
| **动画效果**       | InfoPanel 淡入淡出 vs. 滑动 (不确定)                        |
| **部署路径**       | Netlify / Zeabur / GitHub Pages 任选，其 CI 流程未定 (不确定) |

---

### 总结一句话

FireSight 需在 2D 地图上实时展示全球野火热点及 6 小时蔓延预测，支持交互查看详情、自动与手动刷新，并保持稳定的错误与空状态处理。
